{% extends "base_generic.html" %}

{% block title %}{{ exam.name }}{% endblock %}

{% block breadcrumb %}
<li class="nav-item active">
  <a class="nav-link" href="{% url 'registration:course-detail' exam.course.code %}">{{ exam.course.code }}</a>
</li>
<li class="nav-item active" aria-current="page">
  <span class="nav-link">{{ exam.name }}</span>
</li>
{% endblock %}

{% block content %}
<h1>
  {{ exam.name }}
  <small class="text-muted">{{ exam.course.code }}</small>
</h1>

<div class="row">
  <div class="col-lg-8">
    <p>
      {{ exam.details | linebreaks }}
    </p>
  </div>
</div>


<div class="alert alert-warning" role="alert">
  All human-readable times are displayed in your current timezone,
  <tt>{{ request.user.timezone }}</tt>.
  You can change this setting in your
  <a href="{% url 'registration:profile' %}">profile</a>.
</div>


<div class="row">

  <div class="col-md-6">
    <h2>Time slots</h2>
    {% regroup time_slots by day as time_day_list %}
    {% for time_day in time_day_list %}
    <h3>{{ time_day.grouper|date }}</h3>
    <ul>
      {% for slot in time_day.list %}
      <li>
        <p>
          <strong>{{ slot }}</strong><br>
          <em>Time:</em> {{ slot.start_time|time }} &ndash; {{ slot.end_time|time }}<br>
          <em>Rooms:</em> {{ slot.rooms.all|join:", " }}<br>
          <em>Registered:</em> {{ slot.count_num_registered }}<br>
          <em>Capacity:</em> {{ slot.capacity }}
        </p>
      </li>
      {% endfor %}
    </ul>
    {% endfor %}
  </div>

  <div class="col-md-6">
    <h2>Exam slots</h2>
    {% regroup exam_slots by day as exam_day_list %}
    {% for exam_day in exam_day_list %}
    <h3>{{ exam_day.grouper | date }}</h3>
    <ul>
      {% for slot in exam_day.list %}
      <li>
        <p>
          <strong>{{ slot }}</strong><br>
          <em>Time:</em> {{ slot.get_start_time|time }} &ndash; {{ slot.get_end_time|time }}<br>
          <em>Registrations:</em> {{ slot.exam_registration_set.count }}<br>
          <em>Slots left:</em> {{ slot.count_slots_left }}
        </p>
      </li>
      {% endfor %}
    </ul>
    {% endfor %}
  </div>
</div>

<h2>Exam slot selection</h2>
<p>Your current exam slot: {{ exam_reg.exam_slot }}</p>
<form action="" method="POST">
  {% csrf_token %}

  {% for hidden_field in form.hidden_fields %}
  {{ hidden_field }}
  {% endfor %}

  {% if form.non_field_errors %}
  <div class="alert alert-danger" role="alert">
    {% for error in form.non_field_errors %}
    {{ error }}
    {% endfor %}
  </div>
  {% endif %}

  {% with form.exam_slot as field %}
  <div class="list-group exam-slot-group mb-4">
    {% for radio in field %}
    <div>

      <input type="radio" {% if radio.data.selected %}checked{% endif %}
          id="{{ radio.id_for_label }}"
          name="{{ radio.data.name }}"
          value="{{ radio.data.value }}">

      <label class="list-group-item list-group-item-action"
          for="{{ radio.id_for_label }}">
        {{ radio.choice_label }}
        {% if radio.data.value == exam_reg.exam_slot.pk or radio.data.value == '' and exam_reg.exam_slot is None %}
        <span class="badge badge-info float-right">Current registration</span>
        {% endif %}
      </label>

    </div>
    {% endfor %}

    {% if field.errors %}
    {% for error in field.errors %}
    <div class="invalid-feedback">
      {{ error }}
    </div>
    {% endfor %}
    {% endif %}

  </div>
  {% endwith %}

  <input type="submit" value="Submit">

</form>

{% endblock %}
