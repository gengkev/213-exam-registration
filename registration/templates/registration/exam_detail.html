{% extends "base_generic.html" %}

{% block title %}{{ exam.name }}{% endblock %}

{% block breadcrumb %}
<li class="nav-item active">
  <a class="nav-link" href="{% url 'registration:course-detail' course.code %}">{{ course.code }}</a>
</li>
<li class="nav-item active" aria-current="page">
  <span class="nav-link">{{ exam.name }}</span>
</li>
{% endblock %}

{% block content %}
<h1>
  {{ exam.name }}
  <small class="text-muted">{{ course.code }}</small>
</h1>

<div class="row">
  <div class="col-lg-8">
    <h2>Exam information</h2>
    <p>
      {{ exam.details | linebreaks }}
    </p>
  </div>
</div>



<h2>Select an exam slot</h2>

<div class="alert alert-warning" role="alert">
  <strong>Caution:</strong>
  All human-readable times below (but not in the description above) are
  displayed in your current timezone, which is
  <tt>{{ request.user.timezone }}</tt>.
  You can change this setting in your
  <a href="{% url 'registration:profile' %}">profile</a>.
</div>

<form action="" method="POST">
  {% csrf_token %}

  {% for hidden_field in form.hidden_fields %}
  {{ hidden_field }}
  {% endfor %}

  {% if form.non_field_errors %}
  <div class="alert alert-danger" role="alert">
    {% for error in form.non_field_errors %}
    {{ error }}
    {% endfor %}
  </div>
  {% endif %}


  <!-- No selection -->

  <div class="list-group exam-slot-group mb-4">
    <input class="sr-only" type="radio" id="id_exam_slot_none"
        name="exam_slot" value=""
        {% if selected_slot is None %}checked{% endif %}>

    <label class="list-group-item list-group-item-action d-flex"
        for="id_exam_slot_none">

      <div class="exam-slot-icon">
        <i class="fa fa-check" aria-hidden="true"></i>
        <span class="sr-only">(selected)</span>
      </div>

      <div class="w-100 ml-3">
        <h5 class="d-inline-block">Not registered</h3>
        <div class="d-inline-block float-right">
          {% if slot.pk == exam_reg.exam_slot.pk %}
          <span class="badge badge-info">Current registration</span>
          {% endif %}
        </div>
      </div>
    </label>
  </div>


  <div class="row">

  <!-- Group exam slots by day -->
  {% regroup exam_slots by day as exam_day_list %}
  {% for exam_day in exam_day_list %}

  <div class="col-lg-6">
    <h3>{{ exam_day.grouper|date:"l, F j, Y" }}</h3>

    <div class="list-group exam-slot-group mb-4">
      {% for slot in exam_day.list %}

      <input class="sr-only" type="radio" id="id_exam_slot_{{ slot.pk }}"
          name="exam_slot" value="{{ slot.pk }}"
          {% if slot.pk == selected_slot %}checked{% endif %}>

      <label class="list-group-item list-group-item-action d-flex"
          for="id_exam_slot_{{ slot.pk }}">

        <div class="exam-slot-icon">
          <i class="fa fa-check" aria-hidden="true"></i>
          <span class="sr-only">(selected)</span>
        </div>

        <div class="w-100 ml-3">
          <h5 class="mb-0 d-inline-block" title="{{ slot }}">
            {{ slot.get_start_time|time:"h:i a" }}
          </h5>

          <span class="ml-2 text-muted">
            ({{ slot.count_slots_left }} slot{{ slot.count_slots_left|pluralize }} left)
          </span>

          <div class="d-inline-block float-right">
            {% if slot.pk == exam_reg.exam_slot.pk %}
            <span class="badge badge-info">Current registration</span>
            {% endif %}
          </div>

          <p class="mb-0 text-muted" title="Ends at {{ slot.get_end_time|time:"h:i a" }}">
            {{ slot.get_end_time|timeuntil:slot.get_start_time }} long
          </p>

        </div>
      </label>

      {% endfor %} {# slot #}
    </div>
  </div>

  {% endfor %} {# exam_day #}


  {% if form.exam_slot.errors %}
  {% for error in form.exam_slot.errors %}
  <div class="invalid-feedback">
    {{ error }}
  </div>
  {% endfor %}
  {% endif %}

  </div>

  <input class="btn btn-large btn-info" type="submit" value="Submit">

</form>

{% endblock %}
